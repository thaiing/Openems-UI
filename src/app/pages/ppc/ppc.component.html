<div class="page-container">
  <div class="page-header">
    <h1>Hybrid Controller</h1>
  </div>

  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <form [formGroup]="ppcForm" *ngIf="!isLoading">
    <div class="ppc-grid">
      <mat-card formGroupName="activePower">
        <mat-card-header>
          <mat-card-title>Active Power Limit Control</mat-card-title>
          <mat-slide-toggle formControlName="enabled" class="header-toggle"></mat-slide-toggle>
        </mat-card-header>
        <mat-card-content>

          <mat-radio-group formControlName="mode" class="mode-selector">
            <mat-radio-button value="WATT">Limit by Watts (W)</mat-radio-button>
            <mat-radio-button value="PERCENT">Limit by Percent (%)</mat-radio-button>
          </mat-radio-group>

          <mat-form-field appearance="outline">
            <mat-label>Limit Value (W)</mat-label>
            <input matInput type="number" formControlName="limitWatt">
            <mat-hint>Total available power: {{ totalInverterPowerW }} W</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Limit Value (%)</mat-label>
            <input matInput type="number" formControlName="limitPercent">
            <mat-hint>Total available power: 100 %</mat-hint>
          </mat-form-field>

        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button color="primary"
                  (click)="onSaveActivePower()"
                  [disabled]="ppcForm.get('activePower')?.pristine || ppcForm.get('activePower')?.invalid">
            Save
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card formGroupName="reactivePower">
        <mat-card-header>
          <mat-card-title>Reactive Power Control</mat-card-title>
          <mat-slide-toggle formControlName="enabled" class="header-toggle"></mat-slide-toggle>
        </mat-card-header>
        <mat-card-content class="disabled-content">
          <mat-radio-group formControlName="mode" class="mode-selector">
            <mat-radio-button value="KVAR">Limit by kVAR</mat-radio-button>
            <mat-radio-button value="PERCENT">Limit by Percent (%)</mat-radio-button>
          </mat-radio-group>

          <mat-form-field appearance="outline">
            <mat-label>Limit Value (kVAR)</mat-label>
            <input matInput type="number" formControlName="limitKvar">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Limit Value (%)</mat-label>
            <input matInput type="number" formControlName="limitPercent">
          </mat-form-field>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button color="primary" disabled>Save</button>
        </mat-card-actions>
      </mat-card>

    </div>
  </form>
</div>
